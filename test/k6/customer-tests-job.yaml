apiVersion: batch/v1
kind: Job
metadata:
  name: k6-customer-all-tests
  namespace: k6
spec:
  activeDeadlineSeconds: 900  # 15 minutes timeout
  template:
    spec:
      containers:
      - name: k6
        image: grafana/k6:latest
        command: ["/bin/sh"]
        args: ["-c", "echo 'ðŸ§ª Starting K6 Test Suite...' && echo '1/3 Running Soak Test (5m)...' && k6 run /scripts/customer-soak-test.js && echo '2/3 Running Load Test (4m)...' && k6 run /scripts/customer-load-test.js && echo '3/3 Running Spike Test (2m)...' && k6 run /scripts/customer-spike-test.js && echo 'âœ… All tests completed successfully!'"]
        volumeMounts:
        - name: k6-script
          mountPath: /scripts
        env:
        - name: K6_OUT
          value: "json=/tmp/results.json"
        resources:
          requests:
            memory: "1G"
            cpu: "1"
          limits:
            memory: "3G"
            cpu: "2"
      volumes:
      - name: k6-script
        configMap:
          name: k6-customer-test-scripts
          defaultMode: 0755
      restartPolicy: Never
  backoffLimit: 1